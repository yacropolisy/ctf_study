# 3 Network
セキリティコンテストチャレンジブック3章  
ネットワーク問題

## 出題形式

1. pcapファイルの解析
2. サーバ接続型

## pcapファイルの解析

- TCP/IPの通信パケット 
- USBの通信パケット 
- 無線LANの通信パケット 
- Bluethoothの通信パケット

などの通信が記録されたpcapファイルが与えられる。

-> USBなどプロトコルを知らない通信は、ググりながら解く。

## サーバ接続型

- IPアドレスやFQDNなどのアドレス情報 
- pcapファイル

### アドレス情報が得られた場合

- 与えられたアドレスに対してポートスキャンしてみる 
- 開いているポートにアプリケーションを用いてアクセスしてみる 
- ソケット通信を利用してアクセスしてみる 
- これらの通信をパケットキャプチャしてみる

### pcapファイルが得られた場合
パケット中に記録されているアドレスに、適切なプロトコルで接続する。

## WireSharkでの解析

まず、**pcapファイルに記録されているパケットの量**を確認する。

1. パケットが1000パケットより多い場合
2. パケットが1000パケットより少ない場合

で考えるのが一つの目安。

1000パケットより多い場合、 Statistics メニューの様々な統計機能を使って必要なパケットのみに絞り込む。

- IPアドレス
- プロトコル
- ポート
- 通信量

といった点に着目すると良い。詳しくは3.3.3章を参照。

---

絞り込んだ後は、以下の3つが有用

- TCP（UDP）ストリームの追跡
- オブジェクトのエクスポート 
- パケットバイト列をエクスポート


### TCPストリームの追跡

TCP(UDP)のパケットを右クリックして、出現するメニューから`追跡`を選択することで、
やりとりされているデータをつなげて見ることができる。

### オブジェクトのエクスポート 
ウインドウ上部のメニューの"ファイル->オブジェクトのエクスポート"からHTTPなどでやりとりされているファイルを抽出できる。

### パケットバイト列のエクスポート
パケットの詳細を右クリックして`パケットバイト列のエクスポート`を選択。
これによって得られるバイト列を他のツールで解析することもあるらしい。


## Pythonとの組み合わせ

パケットに対して何らかの処理を施したい場合がある。
例えば以下のような場合である。

- パケットの順番が入れ替わっていて、番号順に並び替えたい
- パケットの中の数値を文字列に変換したい

こういった場合では、一つ一つ手でやるわけにもいかないので、Pythonのfor文やif文を用いて対処すると良い。

`scapy`というライブラリで、パケットを読み込むことができる。